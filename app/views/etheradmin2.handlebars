<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://static.fontawesome.com/css/fontawesome-app.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <title>Legerium Governance Dapp</title>
  </head>

  <style>
  body {
    font-size: 12px;
  }
  </style>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="#">[Logo]</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
          </ul>
          <span class="navbar-text">
            <button class="btn btn-primary btn-sm">
              New Ballot <i class="fal fa-box-ballot"></i>
            </button>
          </span>
        </div>
      </div>
    </nav>
    <div class="container">
      <br><br>
      <div class="d-flex justify-content-between">
        <h3> Open Ballots (<small>{{snapshot.votes.length}}</small>) </h3>
        <div><span class="text-muted"> Ledgerium Wallet </span> <span id="walletStatus"><i class="fal fa-times-circle"></i> Not connected</span></div>
      </div>
      <br>
      {{#if !snapshot.votes.length}}
        <p>There are no open ballots</p>
      {{else}}
      {{#each snapshot.votes}}
      <br>
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <small class="text-muted">Proposer</small> <br>
              {{this.validator}}
            </div>
            <div>
              <small class="text-muted">Add </small> <br>
              {{this.address}}
            </div>
            <div>
              <small class="text-muted">Ballot Time (UTC) </small> <br>
              Opened at: 03/26/2018 3:28:21 AM<br>
              Closes at: 03/29/2018 3:28:21 AM
          </div>
        </div>
        <br><br>

        <div>
          <div class="row">

            <div class="col">
              <div class="row">
                <div class="col" style="max-width:70px">
                  <button class="btn btn-danger"> No </button>
                </div>
                <div class="col">
                    <div class="row">
                      <div class="col">
                        <strong> 25% </strong> 2 votes
                      </div>
                    </div>
                    <div class="row">
                      <div class="col">
                        <div class="progress">
                          <div class="progress-bar bg-danger" role="progressbar" style="width:25%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>


            <div class="col">
              <div class="row">
                <div class="col">
                    <div class="row">
                      <div class="col">
                        <span style="float:right"><strong> 75% </strong> 9 votes</span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col">
                        <div class="progress">
                          <div class="progress-bar bg-success" role="progressbar" style="width:75%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col" style="max-width:70px">
                    <button class="btn btn-success"> Yes </button>
                </div>
              </div>
            </div>

          </div>
        </div>
        {{/each}}
        {{/if}}



        <br><br>

        <div class="card-footer">
          <small class="text-muted">Minimum 4 from 6 validators are required to pass the proposal</small>
        </div>

      </div>
    </div>
      <br>
      <h3> Block Producers </h3>

      <br>
      {{#each snapshot.validators }}
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div><small class="text-muted">#{{@index}}</small> {{this}}</div>
            <button onclick="startVote('{{this}}',false)" name="VAButton" value="{{this}}" class="btn btn-danger btn-sm"> Vote out <i class="fal fa-vote-nay"></i></button>
          </div>
        </div>
      </div>
      {{/each }}


      <h3> Validators </h3>
      <br>
      {{#each nodeRows}}

      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div><small class="text-muted">#{{@index}}</small>{{ this.publicKey }}/div>
            <button class="btn btn-success btn-sm"> Vote in <i class="fal fa-vote-yea"></i></button>
          </div>
        </div>
      </div>
      {{/each}}



    </div>

    <br><br>
    <nav class="navbar bottom navbar-light bg-light">
        <div class="container">
          <div class="d-flex justify-content-between" style="width:100%">
            <div>Ledgerium Governance Dapp</div>
            <div>2019 Ledgerium Network. All rights reserved.</div>
            <div>
              <button class="btn btn-light"><i class="fab fa-twitter"></i></button>
              <button class="btn btn-light"><i class="fab fa-medium-m"></i></button>
              <button class="btn btn-light"><i class="fab fa-facebook-f"></i></button>
              <button class="btn btn-light"><i class="fab fa-github"></i></button>
            </div>
          </div>
        </div>
    </nav>
  </body>
  <script src="web3.1-beta.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" language="javascript" src="https://pro.fontawesome.com/releases/v5.6.1/js/all.js"></script>
  <script>
      $(document).ready(function() {
    	   $('#example').DataTable();
      } );

      var currentAccount = '';
      window.addEventListener('load', () => onload(), false);

      const onload = async function() {
        const validators = {{{ json this.snapshot.validators }}};
        const nodes      = {{{ json this.nodeRows }}};
        const votes      = {{{ json this.snapshot.votes }}}
        if(window.ledgerium){
          //latest
          localWeb3 = new Web3(ledgerium);
          try{
            await ledgerium.enable();
          }catch (err){
            document.getElementById('#walletStatus').innerHTML = '<i class="fal fa-times-circle"></i> Please Allow Connection from Ledgerium wallet'
            // ask user to connect to ledgerium wallet
          }
          currentAccount = localWeb3.currentProvider.selectedAddress.toLowerCase();
        /*} else if (window.web3){
          //legacy
          localWeb3 = await new Web3(window.web3.currentProvider);*/
        } else {
          document.getElementById('#walletStatus').innerHTML = `<i class="fal fa-times-circle"></i> Please install and unlock <a href='https://github.com/ledgerium-io/metamask-extension'>Ledgerium Wallet</a> or make sure you are using an admin account`
          // disableAllButtons();
          return;
          //throw new Error('Ledgerium Wallet Not fount');
        }
        // if (!localWeb3.currentProvider.selectedAddress || !checkValidator(localWeb3.currentProvider.selectedAddress.toLowerCase())) {
        //   // show error and return
        //   showError("Please install and unlock <a href='https://github.com/ledgerium-io/metamask-extension'>Ledgerium Wallet</a> or make sure you are using an admin account");
        //   disableAllButtons();
        //   return;
        //   //throw new Error('Ledgerium Wallet Not fount');
        // } else {
        //   // show current meta mask account
        //   document.getElementById('currentMetaMaskAccount').innerHTML = `Current Ethereum Account: ${localWeb3.currentProvider.selectedAddress}`;
        // }

  </script>
</html>
